trigger:
  branches:
    include:
      - master
      - releases/**

pr:
  autoCancel: true
  branches:
    include:
      - master
      - releases/**

pool:
  vmImage: 'ubuntu-latest'

container:
  image: vowpalwabbit/ubuntu2004-build:latest
  endpoint: DockerHub

strategy:
  matrix:
    Debug:
      BUILD_CONFIGURATION: 'Debug'
    Release:
      BUILD_CONFIGURATION: 'Release'
  maxParallel: 2

steps:
- bash: ./.scripts/linux/build.sh $(BUILD_CONFIGURATION)
  displayName: 'Build C++'
  condition: succeeded()

- bash: ./.scripts/linux/test.sh
  displayName: 'Test C++'
  condition: succeeded()

- bash: ./.scripts/linux/test-flatbuffers.sh
  displayName: 'Run Test Flatbuffers C++'
  condition: succeeded()

- bash: ./.scripts/linux/java.sh
  displayName: 'Build + Test Java'
  condition: succeeded()
