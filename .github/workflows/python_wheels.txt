git submodule update --init --recursive


sudo apt install libboost-dev libboost-program-options-dev libboost-system-dev libboost-math-dev libboost-thread-dev libboost-test-dev libboost-python-dev zlib1g-dev cmake python3 python3-pip


# Activate virtual environment
rm -rf .venv wheel_output
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip setuptools wheel 

# Build wheel
pip wheel . -w wheel_output/ --global-option --cmake-options="-DSTATIC_LINK_VW_JAVA=On;-DPython_INCLUDE_DIR=\"$VIRTUAL_ENV/include/python3.12/\"" --verbose

# Audit and repair wheel
sudo apt install patchelf
pip install auditwheel
auditwheel repair wheel_output/*whl -w audit_output/


# Test
pip install -r requirements.txt
pip install audit_output/*.whl --force-reinstall
pip install pytest vw-executor twine setuptools
twine check audit_output/*whl
python -m pytest ./python/tests/
python ./python/tests/run_doctest.py

cd test
python run_tests.py -E 0.001 -f --skip_spanning_tree_tests --vw_bin_path "python3 -m vowpalwabbit" --skip_test 60 61 92 96 149 152 177 193 194 195 220 275 276 324 325 326 349 350 356 357 358 385 389 390 391 392 393 400 399 401 403 431 440


deactivate




